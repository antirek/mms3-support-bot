# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Chat3

## –ë–∞–∑–æ–≤—ã–π URL

```
http://localhost:3000/api
```

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key`:

```http
X-API-Key: your-api-key-here
X-Tenant-ID: tnt_default
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è API –∫–ª—é—á–∞

```bash
npm run generate-key
```

## –û–±—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

- `X-API-Key` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - API –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `X-Tenant-ID` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID —Ç–µ–Ω–∞–Ω—Ç–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `tnt_default`
- `X-Idempotency-Key` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ö–ª—é—á –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

```json
{
  "data": { ... },
  "message": "–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
}
```

### –û—à–∏–±–∫–∞

```json
{
  "error": "Error Type",
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

## –ü–∞–≥–∏–Ω–∞—Ü–∏—è

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ endpoints –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é:

- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10-50)

–û—Ç–≤–µ—Ç —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:

```json
{
  "data": [ ... ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "pages": 10
  }
}
```

## –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤:

### 1. JSON —Ñ–æ—Ä–º–∞—Ç

```json
{
  "meta": {
    "type": "internal"
  }
}
```

### 2. –û–ø–µ—Ä–∞—Ç–æ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```
(field,operator,value)
```

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã:**
- `eq` - —Ä–∞–≤–Ω–æ
- `ne` - –Ω–µ —Ä–∞–≤–Ω–æ
- `in` - –≤ –º–∞—Å—Å–∏–≤–µ: `(type,in,[user,bot])`
- `nin` - –Ω–µ –≤ –º–∞—Å—Å–∏–≤–µ
- `gt` - –±–æ–ª—å—à–µ
- `gte` - –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `lt` - –º–µ–Ω—å—à–µ
- `lte` - –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `regex` - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
- `exists` - —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (AND):**
```
(meta.type,eq,internal)&(meta.channelType,ne,telegram)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `(userId,eq,cnt_72a454kho)` - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- `(name,regex,^John)` - –∏–º—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å John
- `(type,in,[user,bot])` - —Ç–∏–ø –≤ —Å–ø–∏—Å–∫–µ
- `(meta.role,eq,manager)` - —Ñ–∏–ª—å—Ç—Ä –ø–æ meta —Ç–µ–≥—É

## Endpoints

### Tenants (–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)

#### GET /api/tenants
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

#### GET /api/tenants/:id
–ü–æ–ª—É—á–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –ø–æ ID

#### POST /api/tenants
–°–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

**Body:**
```json
{
  "tenantId": "tnt_myorg",
  "name": "My Organization",
  "domain": "myorg.chat3.com",
  "type": "client",
  "isActive": true
}
```

#### PUT /api/tenants/:id
–û–±–Ω–æ–≤–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

#### DELETE /api/tenants/:id
–£–¥–∞–ª–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

---

### Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

#### GET /api/users
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: `(userId,eq,carl)`)
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON: `{"createdAt":-1}`

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(userId,eq,carl)` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å userId = carl
- `(type,in,[user,bot])` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–∏–ø–∞ user –∏–ª–∏ bot
- `(name,regex,^John)` - –∏–º—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å John
- `(meta.role,eq,manager)` - —Ñ–∏–ª—å—Ç—Ä –ø–æ meta —Ç–µ–≥—É

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
- `dialogCount` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ)
- `unreadDialogsCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ)

#### GET /api/users/:userId
–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ userId

#### POST /api/users
–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Body:**
```json
{
  "userId": "carl",
  "name": "Carl Johnson",
  "type": "user"
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- `userId` –Ω–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ—á–∫—É (`.`)
- `type` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `user`

#### PUT /api/users/:userId
–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Body:**
```json
{
  "name": "New Name",
  "type": "bot"
}
```

#### DELETE /api/users/:userId
–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –£–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–∏–∞–ª–æ–≥–∞–º–∏ (DialogMember)

---

### Dialogs (–î–∏–∞–ª–æ–≥–∏)

#### GET /api/dialogs
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(meta.type,eq,internal)` - –¥–∏–∞–ª–æ–≥–∏ —Ç–∏–ø–∞ internal
- `(meta.channelType,eq,whatsapp)` - WhatsApp –¥–∏–∞–ª–æ–≥–∏
- `(dialogId,eq,dlg_...)` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥

#### GET /api/dialogs/:id
–ü–æ–ª—É—á–∏—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ ID

#### POST /api/dialogs
–°–æ–∑–¥–∞—Ç—å –¥–∏–∞–ª–æ–≥

**Body:**
```json
{
  "name": "VIP —á–∞—Ç",
  "createdBy": "agent_42",
  "members": [
    {
      "userId": "carl",
      "type": "user",
      "name": "Carl Johnson"
    },
    {
      "userId": "bot_123",
      "type": "bot",
      "name": "Support Bot"
    }
  ],
  "meta": {
    "channel": "whatsapp",
    "greeting": {
      "value": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
      "dataType": "string",
      "scope": "user_alice"
    }
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞ —Å `members`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `User`
- –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–µ, –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

#### DELETE /api/dialogs/:id
–£–¥–∞–ª–∏—Ç—å –¥–∏–∞–ª–æ–≥

---

### Messages (–°–æ–æ–±—â–µ–Ω–∏—è)

#### GET /api/dialogs/:dialogId/messages
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(type,eq,internal.text)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `(senderId,eq,carl)` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç carl
- `(meta.channelType,eq,whatsapp)` - WhatsApp —Å–æ–æ–±—â–µ–Ω–∏—è

#### POST /api/dialogs/:dialogId/messages
–°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

**Body:**
```json
{
  "senderId": "carl",
  "content": "Hello!",
  "type": "internal.text"
}
```

#### GET /api/messages
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `(field,direction)`

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(type,eq,internal.text)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `(senderId,eq,carl)` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç carl
- `(content,regex,–ø—Ä–∏–≤–µ—Ç)` - —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "–ø—Ä–∏–≤–µ—Ç"
- `(type,eq,internal.text)&(senderId,eq,carl)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç carl

#### GET /api/messages/:messageId
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ ID

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
- –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ú–∞—Å—Å–∏–≤ —Å—Ç–∞—Ç—É—Å–æ–≤ (statuses) —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π
- Meta —Ç–µ–≥–∏

#### PUT /api/messages/:messageId
–û–±–Ω–æ–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**Body:**
```json
{
  "content": "Updated content"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `content`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `message.update`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è meta —Ç–µ–≥ `updated`

---

### Message Status (–°—Ç–∞—Ç—É—Å—ã —Å–æ–æ–±—â–µ–Ω–∏–π)

#### POST /api/users/:userId/dialogs/:dialogId/messages/:messageId/status/:status
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å—ã:**
- `unread` - –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- `delivered` - –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- `read` - –ø—Ä–æ—á–∏—Ç–∞–Ω–æ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–µ `userType` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—á–µ—Ç—á–∏–∫–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (unreadCount)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞

#### GET /api/users/:userId/dialogs/:dialogId/messages/:messageId/statuses
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### Message Reactions (–†–µ–∞–∫—Ü–∏–∏)

#### GET /api/users/:userId/dialogs/:dialogId/messages/:messageId/reactions
–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userId` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

#### POST /api/users/:userId/dialogs/:dialogId/messages/:messageId/reactions/:action
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–Ω—è—Ç—å —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**Path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action` - –¥–µ–π—Å—Ç–≤–∏–µ: `set` (–¥–æ–±–∞–≤–∏—Ç—å) –∏–ª–∏ `unset` (—É–¥–∞–ª–∏—Ç—å)

**Body:**
```json
{
  "reaction": "üëç"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- `action=set` - –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é (–µ—Å–ª–∏ –µ—ë –µ—â–µ –Ω–µ—Ç)
- `action=unset` - —É–¥–∞–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é (–µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

---

### Dialog Members (–£—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–∏–∞–ª–æ–≥–æ–≤)

#### GET /api/dialogs/:dialogId/members
–ü–æ–ª—É—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `filter` - —Ñ–∏–ª—å—Ç—Ä
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

#### POST /api/dialogs/:dialogId/members/add
–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –¥–∏–∞–ª–æ–≥

**Body:**
```json
{
  "userId": "carl",
  "type": "user",
  "name": "Carl Johnson"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `User`
- –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 200 –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞

#### POST /api/dialogs/:dialogId/members/:userId/remove
–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –¥–∏–∞–ª–æ–≥–∞

#### PATCH /api/dialogs/:dialogId/members/:userId/unread
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**Body:**
```json
{
  "unreadCount": 5,
  "lastSeenAt": 1763551369397.6482,
  "reason": "Manual update"
}
```

---

### User Dialogs (–î–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

#### GET /api/users/:userId/dialogs
–ü–æ–ª—É—á–∏—Ç—å –¥–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `includeLastMessage` - –≤–∫–ª—é—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (`true` –∏–ª–∏ `false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`)
- `filter` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤: `(field,operator,value)`
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `(field,direction)`
- `unreadCount` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—á–∏—Å–ª–æ –∏–ª–∏ `gte:N`, `gt:N`, `lte:N`, `lt:N`)
- `lastSeenAt` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (`gte:timestamp`, `gt:timestamp`, `lte:timestamp`, `lt:timestamp`)

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(meta.type,eq,internal)` - –¥–∏–∞–ª–æ–≥–∏ —Ç–∏–ø–∞ internal
- `(meta.channelType,eq,whatsapp)` - WhatsApp –¥–∏–∞–ª–æ–≥–∏
- `(meta.members,in,[john,sara])` - –¥–∏–∞–ª–æ–≥–∏ —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ john –∏–ª–∏ sara
- `(meta.members,$all,[john,sara])` - –¥–∏–∞–ª–æ–≥–∏ –≥–¥–µ –µ—Å—Ç—å –í–°–ï —É–∫–∞–∑–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (john –ò sara)
- `(meta.members,$ne,john)` - –¥–∏–∞–ª–æ–≥–∏ –ë–ï–ó —É—á–∞—Å—Ç–Ω–∏–∫–∞ john
- `(dialogId,eq,dlg_abc123)` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ: `(meta.type,eq,internal)&(meta.channelType,ne,telegram)`

**–ü—Ä–∏–º–µ—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:**
- `(lastInteractionAt,desc)` - –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
- `(lastInteractionAt,asc)` - –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é (—Å—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–º–∏)
- `(unreadCount,desc)` - –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (–±–æ–ª—å—à–µ –ø–µ—Ä–≤—ã–º–∏)

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ unreadCount:**
- `unreadCount=5` - —Ç–æ—á–Ω–æ 5 –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `unreadCount=gte:1` - 1 –∏–ª–∏ –±–æ–ª—å—à–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `unreadCount=gt:0` - –±–æ–ª—å—à–µ 0 –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (unreadCount, lastSeenAt, isActive)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `lastInteractionAt` (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ) –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è
- –ï—Å–ª–∏ `includeLastMessage=true`, –≤–∫–ª—é—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–∂–¥–æ–º –¥–∏–∞–ª–æ–≥–µ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `meta.members` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `&` (AND –ª–æ–≥–∏–∫–∞)

#### GET /api/users/:userId/dialogs/:dialogId/messages
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π (statusMessageMatrix, reactionSet)

#### GET /api/users/:userId/dialogs/:dialogId/messages/:messageId
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–æ–±—â–µ–Ω–∏–∏

---

### Meta Tags (–ú–µ—Ç–∞-—Ç–µ–≥–∏)

#### GET /api/meta/:entityType/:entityId
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ meta —Ç–µ–≥–∏ —Å—É—â–Ω–æ—Å—Ç–∏

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `scope` - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π scope –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Entity Types:**
- `dialog` - –¥–∏–∞–ª–æ–≥
- `message` - —Å–æ–æ–±—â–µ–Ω–∏–µ
- `user` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `tenant` - —Ç–µ–Ω–∞–Ω—Ç
- `system` - —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- `dialogMember` - —É—á–∞—Å—Ç–Ω–∏–∫ –¥–∏–∞–ª–æ–≥–∞

**–ü—Ä–∏–º–µ—Ä:**
```
GET /api/meta/dialog/dlg_abc123?scope=user_alice
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ meta —Ç–µ–≥–æ–≤, scoped –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `scope`, –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å —ç—Ç–∏–º scope –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ

#### PUT /api/meta/:entityType/:entityId/:key
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å meta —Ç–µ–≥

**Body (–ø—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ):**
```json
{
  "value": "whatsapp"
}
```

**Body (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ):**
```json
{
  "value": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
  "dataType": "string",
  "scope": "user_alice"
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `value` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –∑–Ω–∞—á–µ–Ω–∏–µ –ª—é–±–æ–≥–æ —Ç–∏–ø–∞ (string, number, boolean, object, array)
- `dataType` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö: `string`, `number`, `boolean`, `object`, `array` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `string`)
- `scope` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π scope –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- `scope` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ meta —Ç–µ–≥–æ–≤, scoped –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏

#### DELETE /api/meta/:entityType/:entityId/:key
–£–¥–∞–ª–∏—Ç—å meta —Ç–µ–≥

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `scope` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ scoped –∑–Ω–∞—á–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ï—Å–ª–∏ `scope` –Ω–µ —É–∫–∞–∑–∞–Ω, —É–¥–∞–ª—è–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –ï—Å–ª–∏ `scope` —É–∫–∞–∑–∞–Ω, —É–¥–∞–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å —ç—Ç–∏–º scope

---

### Typing (–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏)

#### POST /api/dialogs/:dialogId/member/:userId/typing
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏

**Body:**
```json
{
  "isTyping": true
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `dialog.typing` –≤ RabbitMQ
- –°–æ–∑–¥–∞–µ—Ç TypingUpdate –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞ (–∫—Ä–æ–º–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞)
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥

---

## –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

- `200` - –£—Å–ø–µ—à–Ω–æ
- `201` - –°–æ–∑–¥–∞–Ω–æ
- `204` - –ù–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (—É—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –ù–µ –Ω–∞–π–¥–µ–Ω–æ
- `409` - –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

## Swagger UI

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:3000/api-docs
```

